#!/bin/bash

DIR=$1

if [[ -z $DIR ]]; then
    echo "Usage: $0 DIR"
    exit 1
fi

OIFS="$IFS"
OKUBECONFIG="$KUBECONFIG"
unset KUBECONFIG
IFS=$'\n'

for config in $(find $DIR -type f \( -name "*.conf.decrypted" -o -iname "*.conf" -o -iname "*.yaml" \)); do
    KUBECONFIG="$config:$KUBECONFIG"
done
IFS="$OIFS"

KUBECONFIG=$KUBECONFIG kubectl config view --merge --flatten
KUBECONFIG=$OKUBECONFIG
